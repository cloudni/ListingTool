<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lt.dao.mapper.TransactionMapper">
  <resultMap id="BaseResultMap" type="com.lt.dao.po.TransactionPO">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 25 19:55:16 CST 2015.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="company_id" jdbcType="INTEGER" property="companyId" />
    <result column="type" jdbcType="INTEGER" property="type" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="payment_transaction_type" jdbcType="INTEGER" property="paymentTransactionType" />
    <result column="payment_transaction_id" jdbcType="VARCHAR" property="paymentTransactionId" />
    <result column="ref_id" jdbcType="INTEGER" property="refId" />
    <result column="ref_object" jdbcType="VARCHAR" property="refObject" />
    <result column="ref_date" jdbcType="VARCHAR" property="refDate" />
    <result column="contents" jdbcType="VARCHAR" property="contents" />
    <result column="total" jdbcType="DECIMAL" property="total" />
    <result column="fee" jdbcType="DECIMAL" property="fee" />
    <result column="net" jdbcType="DECIMAL" property="net" />
    <result column="enabled" jdbcType="BIT" property="enabled" />
    <result column="create_time_utc" jdbcType="INTEGER" property="createTimeUtc" />
    <result column="create_user_id" jdbcType="INTEGER" property="createUserId" />
    <result column="update_time_utc" jdbcType="INTEGER" property="updateTimeUtc" />
    <result column="update_user_id" jdbcType="INTEGER" property="updateUserId" />
    
    <result column="company_name" jdbcType="VARCHAR" property="companyName"/>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 25 19:55:16 CST 2015.
    -->
    t1.id as id, t1.company_id as company_id, t1.payment_transaction_type as payment_transaction_type, t1.type as type, 
    t1.status as status, t1.payment_transaction_id as payment_transaction_id, t1.ref_id as ref_id, t1.ref_object as ref_object, t1.ref_date as ref_date, t1.contents as contents, t1.total as total, t1.fee as fee, 
    t1.net as net,t1.enabled as enabled, t1.create_time_utc as create_time_utc, t1.create_user_id as create_user_id, 
    t1.update_time_utc as update_time_utc, t1.update_user_id as update_user_id
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 25 19:55:16 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from lt_transaction t1
    where t1.id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 25 19:55:16 CST 2015.
    -->
    delete from lt_transaction
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.lt.dao.model.Transaction">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 25 19:55:16 CST 2015.
    -->
    insert into lt_transaction (id, company_id, payment_transaction_type, 
      type, status, payment_transaction_id, ref_id, ref_object, ref_date, contents
      total, fee, net, enabled, create_time_utc, 
      create_user_id, update_time_utc, update_user_id
      )
    values (#{id,jdbcType=INTEGER}, #{companyId,jdbcType=INTEGER}, #{payment_transaction_type,jdbcType=INTEGER}, 
      #{type,jdbcType=INTEGER}, #{status,jdbcType=INTEGER}, #{paymentTransactionId,jdbcType=VARCHAR}, #{refId,jdbcType=INTEGER}, #{refObject,jdbcType=VARCHAR}, #{refDate,jdbcType=VARCHAR}, #{contents,jdbcType=VARCHAR},
      #{total,jdbcType=DECIMAL}, #{fee,jdbcType=DECIMAL}, #{net,jdbcType=DECIMAL}, #{enabled,jdbcType=BIT}, #{createTimeUtc,jdbcType=INTEGER}, 
      #{createUserId,jdbcType=INTEGER}, #{updateTimeUtc,jdbcType=INTEGER}, #{updateUserId,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.lt.dao.model.Transaction">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 25 19:55:16 CST 2015.
    -->
    insert into lt_transaction
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="companyId != null">
        company_id,
      </if>
      <if test="paymentTransactionType != null">
        payment_transaction_type,
      </if>
      <if test="type != null">
        type,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="paymentTransactionId != null">
        payment_transaction_id,
      </if>
       <if test="refId != null">
        ref_id,
      </if>
       <if test="refObject != null">
        ref_object,
      </if>
       <if test="refDate != null">
        ref_date,
      </if>
      <if test="contents != null">
        contents,
      </if>
      <if test="total != null">
        total,
      </if>
      <if test="fee != null">
        fee,
      </if>
      <if test="net != null">
        net,
      </if>
      <if test="enabled != null">
        enabled,
      </if>
      <if test="createTimeUtc != null">
        create_time_utc,
      </if>
      <if test="createUserId != null">
        create_user_id,
      </if>
      <if test="updateTimeUtc != null">
        update_time_utc,
      </if>
      <if test="updateUserId != null">
        update_user_id,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=INTEGER},
      </if>
      <if test="companyId != null">
        #{companyId,jdbcType=INTEGER},
      </if>
      <if test="paymentTransactionType != null">
        #{paymentTransactionType,jdbcType=VARCHAR},
      </if>
      <if test="type != null">
        #{type,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        #{status,jdbcType=INTEGER},
      </if>
      <if test="paymentTransactionId != null">
        #{paymentTransactionId,jdbcType=VARCHAR},
      </if>
      <if test="refId != null">
        #{refId,jdbcType=INTEGER},
      </if>
       <if test="refObject != null">
        #{refObject,jdbcType=VARCHAR},
      </if>
      <if test="refDate != null">
        #{refDate,jdbcType=VARCHAR},
      </if>
      <if test="contents != null">
        #{contents,jdbcType=VARCHAR},
      </if>
      <if test="total != null">
        #{total,jdbcType=DECIMAL},
      </if>
      <if test="fee != null">
        #{fee,jdbcType=DECIMAL},
      </if>
      <if test="net != null">
        #{net,jdbcType=DECIMAL},
      </if>
      <if test="enabled != null">
        #{enabled,jdbcType=BIT},
      </if>
      <if test="createTimeUtc != null">
        #{createTimeUtc,jdbcType=INTEGER},
      </if>
      <if test="createUserId != null">
        #{createUserId,jdbcType=INTEGER},
      </if>
      <if test="updateTimeUtc != null">
        #{updateTimeUtc,jdbcType=INTEGER},
      </if>
      <if test="updateUserId != null">
        #{updateUserId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.lt.dao.model.Transaction">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 25 19:55:16 CST 2015.
    -->
    update lt_transaction
    <set>
      <if test="companyId != null">
        company_id = #{companyId,jdbcType=INTEGER},
      </if>
      <if test="paymentTransactionType != null">
        payment_transaction_type = #{paymentTransactionType,jdbcType=INTEGER},
      </if>
      <if test="type != null">
        type = #{type,jdbcType=INTEGER},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="paymentTransactionId != null">
        payment_transaction_id = #{paymentTransactionId,jdbcType=VARCHAR},
      </if>
      <if test="refId != null">
        ref_id = #{refId,jdbcType=INTEGER},
      </if>
      <if test="refObject != null">
        ref_object = #{refObject,jdbcType=VARCHAR},
      </if>
      <if test="refDate != null">
        ref_date = #{refDate,jdbcType=VARCHAR},
      </if>
      <if test="contents != null">
        contents = #{contents,jdbcType=VARCHAR},
      </if>
      <if test="total != null">
        total = #{total,jdbcType=DECIMAL},
      </if>
      <if test="fee != null">
        fee = #{fee,jdbcType=DECIMAL},
      </if>
      <if test="net != null">
        net = #{net,jdbcType=DECIMAL},
      </if>
      <if test="enabled != null">
        enabled = #{enabled,jdbcType=BIT},
      </if>
      <if test="createTimeUtc != null">
        create_time_utc = #{createTimeUtc,jdbcType=INTEGER},
      </if>
      <if test="createUserId != null">
        create_user_id = #{createUserId,jdbcType=INTEGER},
      </if>
      <if test="updateTimeUtc != null">
        update_time_utc = #{updateTimeUtc,jdbcType=INTEGER},
      </if>
      <if test="updateUserId != null">
        update_user_id = #{updateUserId,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.lt.dao.model.Transaction">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Mar 25 19:55:16 CST 2015.
    -->
    update lt_transaction
    set company_id = #{companyId,jdbcType=INTEGER},
      payment_transaction_type = #{paymentTransactionType,jdbcType=INTEGER},
      type = #{type,jdbcType=INTEGER},
      status = #{status,jdbcType=INTEGER},
      payment_transaction_id = #{paymentTransactionId,jdbcType=VARCHAR},
      ref_id = #{refId,jdbcType=INTEGER},
      ref_object = #{refObject,jdbcType=VARCHAR},
      ref_date = #{refDate,jdbcType=VARCHAR},
      contents = #{contents,jdbcType=VARCHAR},
      total = #{total,jdbcType=DECIMAL},
      fee = #{fee,jdbcType=DECIMAL},
      net = #{net,jdbcType=DECIMAL},
      enabled = #{enabled,jdbcType=BIT},
      create_time_utc = #{createTimeUtc,jdbcType=INTEGER},
      create_user_id = #{createUserId,jdbcType=INTEGER},
      update_time_utc = #{updateTimeUtc,jdbcType=INTEGER},
      update_user_id = #{updateUserId,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <resultMap type="com.lt.dao.po.TransactionPO" id="PoResultMap" extends="BaseResultMap">
  	<result column="campaignName" jdbcType="VARCHAR" property="campaignName" />
  </resultMap>
  
  <select id="selectBySelective" resultMap="BaseResultMap" parameterType="com.lt.dao.po.TransactionPO">
    select 
    <include refid="Base_Column_List" />
    , (CASE t1.ref_object WHEN 'ADCampaign' THEN (select t3.name from lt_ad_campaign t3 where t3.id = t1.ref_id)  ELSE t1.ref_object END) as campaignName
    <if test="isManagerPage == 1">
    	, t2.name as company_name
    </if>
    from lt_transaction t1
     <if test="isManagerPage == 1">
    	, lt_company t2
     </if>
    <where>
    	 <trim prefixOverrides="and">
    	 	 <if test="isManagerPage == 1">
		    	and t1.company_id = t2.id
		     </if>
    	 	<if test="companyName != null and companyName != ''">
    	 		and t2.name like CONCAT('%',#{companyName},'%')
    	 	</if>
    	 	<if test="companyId != null and companyId != ''">
	    		and t1.company_id = #{companyId,jdbcType=INTEGER}
	    	</if>
	    	<if test="type != null and type != ''">
	    		and t1.type = #{type,jdbcType=INTEGER}
	    	</if>
	    	<if test="paymentTransactionId != null and paymentTransactionId != ''">
	    		and t1.payment_transaction_id like CONCAT('%',#{paymentTransactionId},'%')
	    	</if>
	    	<if test="totalMin != null">
	    		<![CDATA[
	    			and t1.total >= #{totalMin,jdbcType=DECIMAL}
	    		]]>
	    	</if>
	    	<if test="totalMax != null">
	    		<![CDATA[
	    			and t1.total <= #{totalMax,jdbcType=DECIMAL}
	    		]]>
	    	</if>
	    	<if test="createDateStartInteger != null">
		    	<![CDATA[
					and t1.create_time_utc >= #{createDateStartInteger}
				]]>
	    	</if>
	    	<if test="createDateEndInteger != null">
	    		<![CDATA[
					and t1.create_time_utc <= #{createDateEndInteger}
				]]>
	    	</if>
    	 </trim>
    </where>
    order by create_time_utc desc
  </select>
  
  <select id="selectLastestInsertId" resultType="java.lang.Integer">
  	select LAST_INSERT_ID() 
  </select>
  
  <insert id="batchInsert" parameterType="java.util.List">
    insert into lt_transaction (company_id, type, status, payment_transaction_type, ref_id, ref_object, ref_date
      total, net, enabled, create_time_utc, 
      create_user_id, update_time_utc, update_user_id
      )
      values
   	<foreach collection="list" item="item" index="index" open="" close="" separator=",">
     (#{item.companyId}, #{item.type}, #{item.status}, #{item.paymentTransactionType}, 
      #{item.refId}, #{item.refObject}, #{item.refDate}, #{item.total}, 
      #{item.net}, 1, #{item.createTimeUtc},
      #{item.createUserId}, #{item.updateTimeUtc}, #{item.updateUserId})
    </foreach>
  </insert>
  
  <select id="selectByRefObject" parameterType="com.lt.dao.po.TransactionPO" resultMap="BaseResultMap">
  	select * from lt_transaction where ref_id = #{refId} and ref_object = #{refObject} and ref_date = #{refDate}
  </select>
</mapper>